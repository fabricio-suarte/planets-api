/*get started
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.2.1/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building an application
    id 'application'

    id 'idea'
}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenCentral()
}

sourceCompatibility = 1.8

//Setting integration tests source
sourceSets {
    testIntegration {
        compileClasspath += sourceSets.main.output
        runtimeClasspath += sourceSets.main.output
    }
}

//Setting integration tests configurations
configurations {
    testIntegrationImplementation.extendsFrom implementation
    testIntegrationRuntimeOnly.extendsFrom runtimeOnly
}

//Lets the IDEA knows about this new test project
idea {
    module {
        testSourceDirs += sourceSets.testIntegration.java.srcDirs
        testResourceDirs += sourceSets.testIntegration.resources.srcDirs
        scopes.TEST.plus += [ configurations.testIntegrationCompile ]
    }
}

//Definning a new taks for running integration tests
task integrationTest(type: Test) {
    description = 'Runs integration tests.'
    group = 'verification'

    testClassesDirs = sourceSets.testIntegration.output.classesDirs
    classpath = sourceSets.testIntegration.runtimeClasspath
    outputs.upToDateWhen { false }
    shouldRunAfter test
}

//This makes build dependent on integrationTest. Uncomment if you desire this behaviour...
//check.dependsOn integrationTest

dependencies {

    /* javalin and its dependencies */
    implementation 'io.javalin:javalin:2.7.0'
    implementation 'org.slf4j:slf4j-simple:1.7.25'
    
    implementation 'com.google.code.gson:gson:2.8.5'
    implementation 'org.mongodb:mongodb-driver-sync:3.10.1'
    
    // Use JUnit test framework
    testImplementation 'junit:junit:4.12'
    testIntegrationImplementation 'junit:junit:4.12'
    
    //Jersey rest client (only for integration tests!)
    testIntegrationImplementation 'org.glassfish.jersey.core:jersey-client:2.25.1'
    testIntegrationImplementation 'org.glassfish.jersey.media:jersey-media-json-jackson:2.22.1'
}

// Define the main class for the application
mainClassName = 'com.fabriciosuarte.planets.api.App'